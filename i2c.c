#include "../.X/mcc_generated_files/system/system.h"


#define BAUDRATE 400000UL
#define I2C_BAUD    ((_XTAL_FREQ/(4UL*BAUDRATE))-1)

//-------------------------------------------------------------------------------------------------
//
//-------------------------------------------------------------------------------------------------
void I2C_Initialize(void) {
// Redireccionamiento de puertos ------------------------------------------------------------------
    SSP1CLKPPS		= 0x8;										//	RB0->MSSP1:SCL1;
    RB0PPS			= 0x14;										//	RB0->MSSP1:SCL1;
    SSP1DATPPS		= 0x9;										//	RB1->MSSP1:SDA1;
    RB1PPS			= 0x15;										//	RB1->MSSP1:SDA1;
//--------------------------------------------------------------------------------------------------
	SSP1STAT		= 0b10000000;
	SSP1CON1		= 0b00101000;
	SSP1CON3		= 0x00;
	SSP1ADD			= I2C_BAUD;
    SSP1CON1bits.SSPEN = 1;
}

//-------------------------------------------------------------------------------------------------
//
//-------------------------------------------------------------------------------------------------
void I2C_Start(void){
	SSP1CON2bits.SEN = 1;										// Generar START
	while (SSP1CON2bits.SEN == 1);
}

//-------------------------------------------------------------------------------------------------
//
//-------------------------------------------------------------------------------------------------
void I2C_ReStart(void){
	SSP1CON2bits.RSEN = 1;										// Generar RE-START
	while (SSP1CON2bits.RSEN == 1);
}

//-------------------------------------------------------------------------------------------------
//
//-------------------------------------------------------------------------------------------------
void I2C_Stop(void){
    SSP1CON2bits.PEN = 1;										// Generar STOP
    while (SSP1CON2bits.PEN == 1);
}

//-------------------------------------------------------------------------------------------------
//
//-------------------------------------------------------------------------------------------------
uint8_t I2C_Read(void)
    PIR3bits.SSP1IF = 0;										// clear SSP interrupt
    SSP1CON2bits.RCEN = 1;										// Habilitar recepcion
    while (PIR3bits.SSP1IF == 0);								// Esperar dato recibir
    return SSP1BUF
}

//-------------------------------------------------------------------------------------------------
//
//-------------------------------------------------------------------------------------------------
void I2C_Ack(void){
	PIR3bits.SSP1IF = 0;
	SSP1CON2bits.ACKDT = 0;
	SSP1CON2bits.ACKEN = 1;
//	while (SSP1CON2bits.ACKEN ==  1);
	while (PIR3bits.SSP1IF == 0);
}

//-------------------------------------------------------------------------------------------------
//
//-------------------------------------------------------------------------------------------------
void I2C_Nack(void){
	PIR3bits.SSP1IF = 0;
	SSP1CON2bits.ACKDT = 1;
	SSP1CON2bits.ACKEN = 1;
//	while (SSP1CON2bits.ACKEN ==  1);

	while (PIR3bits.SSP1IF == 0);
}

//-------------------------------------------------------------------------------------------------
//
//-------------------------------------------------------------------------------------------------
void I2C_Write(uint8_t data){
	PIR3bits.SSP1IF = 0;
	SSP1BUF = data;													// Escribir dato en el buffer
	while (PIR3bits.SSP1IF == 0);
}

